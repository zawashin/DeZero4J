package dezero4j.step.step32_2;

import java.util.HashMap;
import java.util.Map;

/**
 * @author Shin-Ichiro Serizawa <zawashin@outlook.com>
 */
public class Config {
    private static Config instance = new Config();
    private Map<String, Boolean> param;

    private Config() {
        param = new HashMap<>();
        param.put("enable_backprop", true);
    }

    public static Config getInstance() {
        return instance;
    }

    public Map<String, Boolean> getParam() {
        return param;
    }
}
package dezero4j.step.step32_2;

import java.io.Closeable;

/**
 * @author Shin-Ichiro Serizawa <zawashin@outlook.com>
 */
public class UsingConfig implements AutoCloseable {
    protected String name;
    protected boolean oldValue;

    public UsingConfig(String name, boolean value) {
        this.name = name;
        Config.getInstance().getParam().put(name, value);
        oldValue = Config.getInstance().getParam().get(name);
    }

    public void restoreConfig() {
        Config.getInstance().getParam().put(name, oldValue);
    }

 
    @Override
    public void close() throws Exception {
        Config.getInstance().getParam().put(name, oldValue);
    }
}
package dezero4j.step.step32_2;

/**
 * @author Shin-Ichiro Serizawa <zawashin@outlook.com>
 */
public class NoGrad extends UsingConfig {
    public NoGrad() {
        super("enable_backprop", false);
    }
}
